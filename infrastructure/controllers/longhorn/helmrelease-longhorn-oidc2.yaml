apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: oauth2-proxy
  namespace: longhorn-system
spec:
  chart:
    spec:
      chart: oauth2-proxy
      version: "7.x.x"
      sourceRef:
        kind: HelmRepository
        name: oauth2-proxy
        namespace: flux-system
  interval: 5m
  values:
    config:
      provider: "oidc"
      oidcIssuerURL: "https://idm.xrs444.net/oauth2/openid/x_longhorn/.well-known/openid-configuration"
      redirectURL: "https://longhorn.xrs444.net/oauth2/callback"
      emailDomains:
        - "*"
      upstreams:
        - http://longhorn-frontend.longhorn-system.svc.cluster.local:80/
    existingSecret: oauth2-proxy
    ingress:
      enabled: false
    service:
      type: ClusterIP
      portNumber: 4180