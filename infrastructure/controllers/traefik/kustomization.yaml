# Traefik - Ingress controller with OAuth2 authentication
# Provides HTTP/HTTPS ingress and routing for cluster services
# Dashboard protected by Kanidm OAuth2 authentication
# CRDs are now managed directly by the Traefik Helm chart (v38+)
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ./oauth2-proxy-sealedsecret.yaml  # OAuth2 credentials
  - ./helmrelease-traefik.yaml  # Main Traefik controller
  - ./helmrelease-traefik-oauth2.yaml  # OAuth2 proxy
  - ./configmap-traefik-helm-chart-value-overrides.yaml
  - ./namespace-traefik.yaml
  - ./kustomization-traefik.yaml  # Flux Kustomization
  - ./middleware-dashboard-auth.yaml  # Dashboard auth
  # Dashboard error handling (unused but kept for future)
  - ./middleware-dashboard-errors.yaml
  - ./middleware-dashboard-redirect.yaml  # Root path redirect to OAuth2 login
  - ./middleware-api.yaml  # API middleware
  - ./ingressroute-dashboard.yaml  # Dashboard ingress
  - ./ingressroute-root-redirect.yaml  # Root path redirect
  - ./ingressroute-oauth2-proxy.yaml  # OAuth2 proxy
  # Metrics NodePort for external Prometheus
  - ./service-traefik-metrics-nodeport.yaml
