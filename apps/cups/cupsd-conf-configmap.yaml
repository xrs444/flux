---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cupsd-conf
  namespace: cups
data:
  cupsd.conf: |
    # Minimal CUPS config for remote admin (for testing)
    # Restrict to your subnet for production!
    LogLevel warn
    Listen 0.0.0.0:631
    Listen /var/run/cups/cups.sock
    Browsing On
    BrowseLocalProtocols dnssd
    DefaultAuthType Basic
    WebInterface Yes

    # Allow remote access
    <Location />
      Order allow,deny
      Allow all
    </Location>

    <Location /admin>
      Order allow,deny
      Allow all
    </Location>

    <Location /admin/conf>
      AuthType Default
      Require user @SYSTEM
      Order allow,deny
      Allow all
    </Location>

    # Allow shared printers
    <Policy default>
      <Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job \
        Purge-Jobs Set-Job-Attributes Create-Job-Subscription \
        Renew-Subscription Cancel-Subscription Get-Notifications \
        Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job \
        CUPS-Get-Document>
        Require user @OWNER @SYSTEM
        Order deny,allow
      </Limit>
      <Limit All>
        Order deny,allow
      </Limit>
    </Policy>
