---
apiVersion: batch/v1
kind: Job
metadata:
  name: immich-init-storage
  namespace: immich
spec:
  ttlSecondsAfterFinished: 300
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: init
          image: busybox:latest
          command:
            - /bin/sh
            - -c
            - |
              mkdir -p /upload/upload /upload/thumbs /upload/profile \
                       /upload/video /upload/encoded-video /upload/backups
              touch /upload/upload/.immich /upload/thumbs/.immich \
                    /upload/profile/.immich /upload/video/.immich \
                    /upload/encoded-video/.immich /upload/backups/.immich
              ls -la /upload/
              ls -la /library/
          volumeMounts:
            - name: upload
              mountPath: /upload
            - name: library
              mountPath: /library
      volumes:
        - name: upload
          persistentVolumeClaim:
            claimName: immich-upload
        - name: library
          persistentVolumeClaim:
            claimName: immich-photos
