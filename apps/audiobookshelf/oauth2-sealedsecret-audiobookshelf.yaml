# yamllint disable rule:line-length
---
# Audiobookshelf OpenID Connect credentials for Kanidm
# audiobookshelf configures OIDC via the web UI: Settings > Authentication
# After deploying, retrieve credentials with:
#   kubectl get secret oauth2-secret-audiobookshelf -n audiobookshelf \
#     -o jsonpath='{.data.client-id}' | base64 -d
#   kubectl get secret oauth2-secret-audiobookshelf -n audiobookshelf \
#     -o jsonpath='{.data.client-secret}' | base64 -d
#
# Kanidm setup:
#   kanidm system oauth2 create oauth2_audiobookshelf \
#     "Audiobookshelf" https://audiobookshelf.xrs444.net
#   kanidm system oauth2 add-redirect-url oauth2_audiobookshelf \
#     https://audiobookshelf.xrs444.net/auth/openid/mobile-redirect
#   kanidm system oauth2 add-redirect-url oauth2_audiobookshelf \
#     https://audiobookshelf.xrs444.net/auth/openid/callback
#
# Issuer URL for audiobookshelf UI:
#   https://idm.xrs444.net/oauth2/openid/oauth2_audiobookshelf
#
# To seal: kubeseal --format yaml \
#   < secret-audiobookshelf.yaml > oauth2-sealedsecret-audiobookshelf.yaml
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  name: oauth2-secret-audiobookshelf
  namespace: audiobookshelf
spec:
  encryptedData:
    client-id: REPLACE_WITH_SEALED_VALUE
    client-secret: REPLACE_WITH_SEALED_VALUE
  template:
    metadata:
      name: oauth2-secret-audiobookshelf
      namespace: audiobookshelf
    type: Opaque
